<%- @addresses = Address.where(:user_id => current_user.id).collect {|a| [ a.identifier, a.id ] } %>

<br>
    <%- if @addresses.count > 0 %>
    <%- @address_id = Address.where(:user_id => current_user.id, :default => true).last.id %>
        <h5>Selecione o endereço da entrega, ou adicione um novo endereço.</h5>
        <div class="address_selector">
            <%= select 'address', 'address_id', @addresses, {:selected => "#{@address_id}", :include_blank => 'Adicionar um novo endereço...' } %>
        </div>
    <%- else %>
        <h5>Por favor adicione o seu endereço para a entrega.</h5>
    <%- end %>
    <div class="add_address_btn">
        <%= button_to_function t('add_new_address'), "javascript:showNewAddressFields();" %>
    </div>
<br>
<br>
<%- if @addresses.count > 0 %>
<%= render '/checkout/show_address' %>
<%- end %>
<br>
<div class="new_address">
    <div class=".errors"></div>
<%= simple_form_for(:address, :html => {:class => 'sign_up', :id => 'address_form'}, :url => create_address_path, :remote => true) do |f| %>
  <fieldset>
    <%= f.input :user_id, :as => :hidden, :input_html => {:value => current_user.id} %>
    <div class="identifier_field">
        <%= f.input :identifier, placeholder: 'Ex: Minha Casa, Escritorio, etc', :label => t('activerecord.attributes.address.identifier') %>
    </div>
    <div class="default_field">
        <%= f.input :default, :as => :boolean, input_html: { checked: true }, :label => t('activerecord.attributes.address.default') %>
    </div>
  	<div class="zip_code_field">
    	<%= f.input :zip_code, :label => t('activerecord.attributes.address.zip_code') %>
    </div>
    <div class="zip_code_btn">
        <%= button_to_function t('find_zip_code'), "javascript:findZipCode()" %>
	</div>
    <div class="address_field">
    	<%= f.input :address, :label => t('activerecord.attributes.address.address') %>
    </div>
    <div class="number_field">
    	<%= f.input :number, :label => t('activerecord.attributes.address.number') %>
    </div>
    <div class="complement_field">
    	<%= f.input :complement, :label => t('activerecord.attributes.address.complement'), :required => false %>
    </div>
    <div class="district_field">
    	<%= f.input :district, :label => t('activerecord.attributes.address.district') %>
    </div>
    <div class="city_field">
    	<%= f.input :city, :label => t('activerecord.attributes.address.city') %>
    </div>
    <div class="state_field">
        <%= f.input :state, :label => t('activerecord.attributes.address.state'),
            :collection => ["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"] %>
    </div>
    <%= f.submit t('next') %>
  </fieldset>
<% end %>
</div>
<br>

<%- if @addresses.count > 0 %>    
    <%= button_tag t('next'), class: 'go_to_third_step' %>
<%- end %>

<%- content_for :page_javascripts do %>
  <script>
    $('.go_to_third_step').on('click', function(event){
      $('.address_wrapper').html("<%= escape_javascript(render '/checkout/third_step') %>");
    });
  </script>
<% end %>