<% page_data :title => 'Carrinho de compras', :type => 'other' %>

<div id="tag">
  <div class="container">
    <%= yield :h1 %>

    <% if @cart_items.present? %>
      <%= simple_form_for(:cart, :url => update_cart_path, :method => :put) do |f| %>

        <table class="cart-page-table table">
          <thead>
            <tr>
              <td>Título</td>
              <td>Quantidade</td>
              <td>Peso</td>
              <td>Preço</td>
              <td>Remover</td>
            </tr>
          </thead>

          <tbody>
            <% @cart_items.each do |cart_item| %>
              <tr>
                <td>
                  <%= content_tag(:div, image_tag(cart_item.book.cover_url.to_s), :class => 'cart-book-cover cover') %>
                  <%= content_tag(:div, content_tag(:p, cart_item.book.title, :class => 'cart-book-title') + content_tag(:p, authors(cart_item.book), :class => 'cart-book-authors'), :class => 'cart-book-data') %>
                </td>
                <td class="cart-page-book-quantity">
                  <%= f.input "quantity_#{cart_item.book.id}", :label => false, :input_html => { :value => "#{cart_item.quantity}" } %>
                </td>
                <td class="cart-page-book-weight">
                  <%= (cart_item.book.weight * 1000).to_i.*(cart_item.quantity) %>g
                </td>
                <td class="cart-page-book-price">
                  <%= number_to_currency(cart_item.book.price_print.*(cart_item.quantity)) %>
                </td>
                <td class="cart-page-remove-item">
                  <%= link_to("x", remove_from_cart_path(cart_item.book.id), :method => :post) %>
                </td>
              </tr>
            <% end %>
            <tr>
              <td id="cart-form-total" colspan="5">
                Total <span><%= total_cart_price %></span>
              </td>
            </tr>
          </tbody>
        </table>

        <%= f.button :submit, 'Atualizar carrinho', :class => 'btn cart-form-button-update' %>
      <% end %>

      <%= render :partial => 'pagseguro_form_cart' %>
    <% else %>
      <p>Você não tem livros no carrinho.</p>
    <% end %>
  </div>
</div>
