<% page_data :title => 'Carrinho de compras', :type => 'other' %>

<div id="tag">
  <div class="container">
    <%= yield :h1 %>

    <% if @cart_items.present? %>
      <%= simple_form_for(:cart, :url => update_cart_path, :method => :put) do |f| %>

        <table class="cart-page-table table">
          <thead>
            <tr>
              <td>Título</td>
              <td>Quantidade</td>
              <td>Peso</td>
              <td>Preço</td>
              <td>Remover</td>
            </tr>
          </thead>

          <tbody>
            <% @cart_items.each do |book, quantity| %>
              <tr>
                <td>
                  <%= content_tag(:div, image_tag(book.cover_url.to_s), :class => 'cart-book-cover cover') %>
                  <%= content_tag(:div, content_tag(:p, book.title, :class => 'cart-book-title') + content_tag(:p, authors(book), :class => 'cart-book-authors'), :class => 'cart-book-data') %>
                </td>
                <td class="cart-page-book-quantity">
                  <%= f.input "quantity_#{book.id}", :label => false, :input_html => { :value => "#{quantity}" } %>
                </td>
                <td class="cart-page-book-weight">
                  <%= (book.weight * 1000).to_i.*(quantity).to_s + "g" if book.weight %>
                </td>
                <td class="cart-page-book-price">
                  <%= number_to_currency(show_price(book).*(quantity)) %>
                </td>
                <td class="cart-page-remove-item">
                  <%= link_to("x", remove_from_cart_path(book.id), :method => :post) %>
                </td>
              </tr>
            <% end %>
            <tr>
              <td id="cart-form-total" colspan="5">
                Total <span><%= number_to_currency(@cart_price) %></span>
              </td>
            </tr>
          </tbody>
        </table>

        <%= f.button :submit, 'Atualizar carrinho', :class => 'btn cart-form-button-update' %>
      <% end %>

    <% else %>
      <p>Você não tem livros no carrinho.</p>
    <% end %>
  </div>
</div>


<div id="tmp">
  <div class="container">
    <%- if current_user %>
        <%= render '/checkout/second_step' %>
    <%- else %>
        <%= render '/checkout/sign_up_or_sign_in' %>
    <%- end %>
  </div>
</div>  

<div id="third_step">
  <div class="container">
      <h5>A entrega será realizada no endereço:</h5>
      <%= render '/checkout/show_address' %>

      <ul>
        <li>
          <%= link_to({controller: "payment", action: "index", remote: true}, {id: "link_to_credit_card"}) do %>
            <div>Prosseguir, using Credit Card</div>
          <% end %>
        </li>

        <li>      
          <%= link_to({controller: "payment", action: "index", remote: true}) do %>
            <div>payment method 2</div>
          <% end %>
        </li>

        <li>
          <%= link_to(finish_checkout_url, {title: 'Finalizar compra com o Paypal'}) do %>
            <div class="row">
              <span class="span8">
                Finalize a sua compra clicando no botão ao lado, você será direcionado para o ambiente seguro do PayPal, onde irá realizar o pagamento.
              </span>
              
              <div class="paypal_button span3">Finalizar compra</div>
            </div>
          <% end %>
        </li>
      </ul>

  </div> 
</div>   


<div id="payment"></div>

