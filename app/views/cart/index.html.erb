<% page_data :title => 'Carrinho de compras', :type => 'other' %>

<div id="tag">
  <div class="container">
    <%= yield :h1 %>

    <% if @cart_items.present? %>
      <%= simple_form_for(:cart, :url => update_cart_path, :method => :put) do |f| %>

        <table class="cart-page-table table">
          <thead>
            <tr>
              <td>Título</td>
              <td>Quantidade</td>
              <td>Peso</td>
              <td>Preço</td>
              <td>Remover</td>
            </tr>
          </thead>

          <tbody>
            <% @cart_items.each do |book, quantity| %>
              <tr>
                <td>
                  <%= content_tag(:div, image_tag(book.cover_url.to_s), :class => 'cart-book-cover cover') %>
                  <%= content_tag(:div, content_tag(:p, book.title, :class => 'cart-book-title') + content_tag(:p, authors(book), :class => 'cart-book-authors'), :class => 'cart-book-data') %>
                </td>
                <td class="cart-page-book-quantity">
                  <%= f.input "quantity_#{book.id}", :label => false, :input_html => { :value => "#{quantity}" } %>
                </td>
                <td class="cart-page-book-weight">
                  <%= (book.weight * 1000).to_i.*(quantity).to_s + "g" if book.weight %>
                </td>
                <td class="cart-page-book-price">
                  <%= number_to_currency(show_price(book).*(quantity)) %>
                </td>
                <td class="cart-page-remove-item">
                  <%= link_to("x", remove_from_cart_path(book.id), :method => :post) %>
                </td>
              </tr>
            <% end %>
            <tr>
              <td id="cart-form-total" colspan="5">
                Total <span><%= number_to_currency(@cart_price) %></span>
              </td>
            </tr>
          </tbody>
        </table>

        <%= f.button :submit, 'Atualizar carrinho', :class => 'btn cart-form-button-update' %>
      <% end %>

    <% else %>
      <p>Você não tem livros no carrinho.</p>
    <% end %>
  </div>
</div>


<div id="tmp">
  <div class="container">
    <%- if current_user %>
        <%= render '/checkout/second_step' %>
    <%- else %>
        <%= render '/checkout/sign_up_or_sign_in' %>
    <%- end %>
  </div>
</div>  



<div class="container">
  <h4 id="link_to_payment_card"><input type="radio" checked="checked"/><i class="icon-credit-card"></i> Cartão de Crédito</h4>
</div>

<div id="payment_card">
  <div class="container">
    
    <div class="card-wrapper"></div>

    <div class="alert alert-error" style="display: none;"><ul></ul></div>

    <%= form_tag({controller: :payment, action: :credit_card} ) do %>

      <div class="row">
        <div class="span6"><input autocomplete="off" data-iugu="number" placeholder="Número do Cartão" type="text" value="" /></div>
        <div class="span6"><input autocomplete="off" data-iugu="full_name" placeholder="Titular do Cartão" type="text" value="" /></div>
      </div>

      <div class="row">
        <div class="span6"><input autocomplete="off" data-iugu="expiration" placeholder="MM/AAAA" type="text" value="" /></div>
        <div class="span6"><input autocomplete="off" data-iugu="verification_value" placeholder="CVV" type="text" value="" /></div>
      </div>
        
      <input type="hidden" name="token" id="token"/>

      <%= render "address"%>

      <input type="submit" class="btn" value="Pagar" />
    <% end %>
  </div>

</div>



<div class="container">
  <h4 id="link_to_payment_slip"><input type="radio" /><i class="icon-barcode"></i> Boleto Bancário</h4>
</div>

<div id="payment_slip">
  <div class="container">

    <div class="alert alert-error" style="display: none;"><ul></ul></div>

    <%= form_tag({controller: :payment, action: :bank_slip} ) do %>

      <h3><i class="icon-user"></i> Dados Pessoais</h3>

      <div class="row">
        <div class="span6"><input type="text" placeholder="CPF/CNPJ" name="cpf_cnpj" myrequired /></div>
        <div class="span6"><input type="text" placeholder="Nome no boleto" name="client_name" myrequired /></div>
      </div>

      <div class="row">
        <div class="span6"><input type="text" placeholder="Telefone Prefix" name="phone_prefix" myrequired /></div>
        <div class="span6"><input type="text" placeholder="Telefone" name="phone" myrequired /></div>
      </div>

      <%= render "address"%>

      <input type="submit" class="btn" value="Pagar" />
    <% end %>

  </div>
</div>


<div class="container">
  <h4 id="link_to_payment_paypal"><input type="radio" /> Paypal</h4>
</div>

<div id="payment_paypal">
  <div class="container">
    <div class="alert alert-error" style="display: none;"><ul></ul></div>
    <%= form_tag({controller: :checkout, action: :finish} ) do %>
      <%= render "address"%>
      <input type="submit" class="btn" value="Pagar" />
    <% end %>
  </div>
</div>


<div class="modal hide fade" id="payment-modal" aria-hidden="true" style="display: none;">
  <div class="modal-body">
    <p>watting...</p>
  </div>
</div>


<script type="text/javascript">
$('#payment_card form').card({
  container: $('.card-wrapper'),
  numberInput: 'input[data-iugu="number"]', 
  expiryInput: 'input[data-iugu="expiration"]',
  cvcInput: 'input[data-iugu="verification_value"]',
  nameInput: 'input[data-iugu="full_name"]'
})
</script>

