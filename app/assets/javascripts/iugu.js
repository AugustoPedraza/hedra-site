(function(e,t){function s(){if(!r){r=!0;for(var e=0;e<n.length;e++)n[e].fn.call(window,n[e].ctx);n=[]}}function o(){document.readyState==="complete"&&s()}e=e||"docReady",t=t||window;var n=[],r=!1,i=!1;t[e]=function(e,t){if(r){setTimeout(function(){e(t)},1);return}n.push({fn:e,ctx:t}),document.readyState==="complete"?setTimeout(s,1):i||(document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):(document.attachEvent("onreadystatechange",o),window.attachEvent("onload",s)),i=!0)}})("dispatchOnLoad",window);var Iugu=function(){function o(e,t){var n,r,i;r=e.getElementsByTagName("input"),i=e.getElementsByTagName("select"),n={};for(var s=0;s<r.length;s++){attr=r[s].getAttribute("data-iugu");if(attr==null)continue;if(t.indexOf(attr)==-1)continue;n[attr]=r[s].value,attr=="full_name"&&(splitted_name=Iugu.utils.getFirstLastNameByFullName(r[s].value),n.first_name=splitted_name[0],n.last_name=splitted_name[1])}for(var s=0;s<i.length;s++){attr=i[s].getAttribute("data-iugu");if(attr==null)continue;if(t.indexOf(attr)==-1)continue;i[s].selectedIndex!=null&&(n[attr]=i[s].options[i[s].selectedIndex].value)}return n}function u(e,t,n){t==null&&(t=[]);for(index in e)param=e[index],n&&(index=n+"["+index+"]"),typeof param=="object"?u(param,t,index):t.push(index+"="+encodeURIComponent(param));return t.join("&").replace(/%20/g,"+")}function a(){return e+"/"+t+"/"}function f(e,t){var r=t.callbackName||"callback",i=t.onSuccess||function(){},s=t.onTimeout||function(){},o=t.onError||function(){},a=t.timeout||10,f=t.data||{},l=r;if(window[l]==1)return;var c=(new Date).getTime();r+=++c,f.account_id=n,f.callback=r;var h=document.createElement("script");window[l]=!0;var p=function(){try{delete window[r],delete window[l]}catch(e){window[r]=void 0,window[l]=undefined}},d=window.setTimeout(function(){window[l]=undefined},a*1e3),v=window.setTimeout(function(){window[r]=function(){},s(),document.getElementsByTagName("head")[0].removeChild(h),p()},a*1e3);window[r]=function(e){window.clearTimeout(v),i(e),document.getElementsByTagName("head")[0].removeChild(h),p()},h.type="text/javascript",h.async=!0,h.src=e+"?"+u(f),h.onerror=function(){window.clearTimeout(v),o(),document.getElementsByTagName("head")[0].removeChild(h),p()},document.getElementsByTagName("head")[0].appendChild(h)}var e="https://api.iugu.com",t="v1",n=null,r=!1,i=["number","verification_value","first_name","last_name","expiration","expiration_month","expiration_year","full_name"];window.hasOwnProperty=window.hasOwnProperty||Object.prototype.hasOwnProperty,Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1}),typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var s={listen:function(e,t,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var r=t.attachEvent("on"+e,n);return r}},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){s.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(s.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," "),e.className=e.className.replace("  "," "),e.className=e.className.trim()}}};return cards={visa:{cvv_pattern:/^[0-9]{3}$/,brand:[40,41,42,43,44,45,46,47,48,49]},mastercard:{cvv_pattern:/^[0-9]{3}$/,brand:[50,51,52,53,54,55,56,57,58,59]},amex:{cvv_pattern:/^[0-9]{4}$/,brand:[34,37]},diners:{cvv_pattern:/^[0-9]{3}$/,brand:[30,36,38,39]},elo:{cvv_pattern:/^[0-9]{3}$/,brand:[63]}},utils={validateAccountID:function(e){if(!/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/.test(e))return"ID de Conta (AccountID) inválido.\r\nConfigure usando o método setAccountID()"},formatUUID:function(e){var t=e.toUpperCase().replace("-","");return t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20,12)},validateCreditCardNumber:function(e){if(e.length==0||/[^0-9-\s]+/.test(e))return!1;var t=0,n=0,r=!1;e=e.replace(/\D/g,"");for(var i=e.length-1;i>=0;i--){var s=e.charAt(i),n=parseInt(s,10);r&&(n*=2)>9&&(n-=9),t+=n,r=!r}return t%10==0},validateCVV:function(e,t){return t?cards[t]?cards[t].cvv_pattern.test(e):!1:!1},validateExpiration:function(e,t){today=new Date;if(e==undefined)return!1;if(t==undefined)return!1;t.length==2&&(t=today.getFullYear().toString().substr(0,2)+t);if(t<today.getFullYear())return!1;if(t==today.getFullYear())if(e>12||e<today.getMonth()+1)return!1;return!0},validateExpirationString:function(e){return e=this.getMonthYearByFullExpiration(e),!e||e.length!=2?!1:this.validateExpiration(e[0],e[1])},validateFirstName:function(e){return!e||e.length==0?!1:!0},validateLastName:function(e){return!e||e.length==0?!1:!0},getMonthYearByFullExpiration:function(e){return e?(e=e.toString().split("/"),!e||e.length!=2?!1:[e[0],e[1]]):!1},getFirstLastNameByFullName:function(e){return e?(e=e.toString().split(" "),[e.shift(),e.join(" ")]):!1},getBrandByCreditCardNumber:function(e){first_two=parseInt(e.slice(0,2));for(var t in cards)if(cards.hasOwnProperty(t)){var n=cards[t];if(cards[t].brand.indexOf(first_two)!=-1)return utils.keyOf(cards,cards[t])}return!1},trim:function(e){return e.replace(/^\s+/g,"").replace(/\s+$/,"")},keyOf:function(e,t){for(var n in e)if(hasOwnProperty.call(e,n)&&e[n]===t)return n;return null}},{utils:utils,CreditCard:function(e,t,n,r,i,s){e=e,e&&(e=e.replace(/ +/g,""),e=e.replace(/-+/g,"")),t=t,n=n;var o=new Date;return n!=undefined&&n.length==2&&(n=o.getFullYear().toString().substr(0,2)+n),r=r,i=i,r!=undefined&&(r=r.toUpperCase()),i!=undefined&&(i=i.toUpperCase()),s=s,{errors:function(){_errors={};if(!e||!utils.validateCreditCardNumber(e))_errors.number="is_invalid";if(!s||!utils.validateCVV(s,utils.getBrandByCreditCardNumber(e)))_errors.verification_value="is_invalid";if(!t||!n||!utils.validateExpiration(t,n))_errors.expiration="is_invalid";if(!r||!utils.validateFirstName(r))_errors.first_name="is_invalid";if(!i||!utils.validateLastName(i))_errors.last_name="is_invalid";return _errors},valid:function(){return Object.keys(this.errors()).length>0?!1:!0},brand:function(){return utils.getBrandByCreditCardNumber(e)},toData:function(){return{number:e,verification_value:s,first_name:r,last_name:i,month:t,year:n,brand:this.brand()}}}},createPaymentToken:function(e,t){err=utils.validateAccountID(n);if(err){alert(err);return}cc=!1,e.tagName!==undefined&&e.tagName.toUpperCase()=="FORM"?(formData=o(e,i),expiration=this.utils.getMonthYearByFullExpiration(formData.expiration),cc=this.CreditCard(formData.number,expiration[0],expiration[1],formData.first_name,formData.last_name,formData.verification_value)):e.toData!==undefined?cc=e:e.number!==undefined&&(cc=this.CreditCard(e.number,e.month,e.year,e.first_name,e.last_name,e.verification_value));var s=t||function(){};if(!cc.valid())return s({errors:cc.errors()});data={method:"credit_card",data:cc.toData()},r==1&&(data.test=1),f(a()+"payment_token",{data:data,onSuccess:function(e){e.errors==undefined&&e.id.length==32&&(e.id=utils.formatUUID(e.id)),s(e)},onTimeout:function(){s({errors:{timeout:"operation_timeout"}})}})},setAccountID:function(e){n=e,this.setup()},setTestMode:function(e){r=e},setup:function(){var e=!1;typeof Formatter!="undefined"&&(e=!0),typeof this.initializedFields=="undefined"&&(this.initializedFields=[]);if(e==0)return;inputs=document.getElementsByTagName("input");for(var t=0;t<inputs.length;t++){attr=inputs[t].getAttribute("data-iugu");if(attr==null)continue;if(this.initializedFields.indexOf(inputs[t])!=-1)continue;this.initializedFields.push(inputs[t]);if(attr=="number"){var n=inputs[t];formatter=new Formatter(n,{pattern:"{{9999}} {{9999}} {{9999}} {{9999}}",persistent:!1}),s.listen("keyup",n,function(e){number=n.value.replace(/\ /g,""),number=number.replace(/\-/g,""),brand=utils.getBrandByCreditCardNumber(number),form=n.form;if(s.hasClass(form,brand))return;s.removeClass(form,"visa"),s.removeClass(form,"mastercard"),s.removeClass(form,"amex"),s.removeClass(form,"diners"),s.removeClass(form,"elo"),brand&&(s.addClass(form,brand),brand=="amex"?formatter.resetPattern("{{9999}} {{9999999}} {{99999}}"):brand=="diners"?formatter.resetPattern("{{9999}} {{999999}} {{9999}}"):formatter.resetPattern("{{9999}} {{9999}} {{9999}} {{9999}}"))})}else attr=="expiration"?new Formatter(inputs[t],{pattern:"{{99}}/{{99}}",persistent:!1}):attr=="verification_value"&&new Formatter(inputs[t],{pattern:"{{9999}}",persistent:!1})}}}}();dispatchOnLoad(function(){Iugu.setup()});